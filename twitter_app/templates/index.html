{% extends 'base.html' %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-lg-5">
                <h1>Welcome to Twitter Mapping</h1>
            </div>
            <div class="col-lg-2 col-lg-offset-5">
                {% if user.is_authenticated %}
                    <a href="{% url 'auth_logout' %}">
                        <input type="button" class="btn btn-danger" value="Logout"
                               style="margin:auto;margin-top: 20px;">
                    </a>
                {% else %}
                    <a href="{% url 'auth_login' %}">
                        <input type="button" class="btn btn-success" value="Login"
                               style="margin:auto;margin-top: 20px;">
                    </a>
                    <a href="{% url 'registration_register' %}">
                        <input type="button" class="btn btn-default" value="Register"
                               style="margin:auto;margin-top: 20px;">
                    </a>
                {% endif %}
            </div>
        </div>
        {% if user.is_authenticated %}
            <div class="row">
                <div class="col-lg-4 col-lg-offset-1">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4>Latest Tweets From {{ twitter_user.name }}</h4>
                        </div>

                        <div class="panel-body">
                            <div class="user-select">
                                <form method="get" action="#">
                                    <div class="input-group">
                                        <span class="input-group-addon">@</span>
                                        <input type="text" class="form-control" name="user"
                                               placeholder="Enter A Twitter Username">
                                    </div>
                                </form>
                            </div>
                            <br>
                            <div class="tweets">
                                {% for tweet in twitter %}
                                    <div class="tweet  well well-sm">
                                        <p>{{ tweet.text|safe }}</p>
                                        {% if tweet.country %}
                                            <p class="text-muted">{{ tweet.country.name }}</p>
                                            <button id="map_btn_{{ tweet.id }}" class="btn btn-info js-mapbtn"
                                                    onclick="show_tweet('{{ tweet.country.latitude }}', '{{ tweet.country.longitude }}', 'map_btn_{{ tweet.id }}')">
                                                Show Country on Map
                                            </button>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-lg-offset-1">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div id="js-map" style="min-height: 300px;height:100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div>
                <h1>Login or Register to Continue</h1>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.4/gmaps.min.js"></script>
    <script>
        gmap = new GMaps({
            div: '#js-map',
            lat: 32.397081,
            lng: -3.199736,
            zoom: 1
        });

        function show_tweet(latitude, longitude, button_id) {
            gmap.removeMarkers();
            $('.js-mapbtn').removeAttr('disabled');
            gmap.addMarker({
                lat: latitude,
                lng: longitude
            });
            button_id = '#' + button_id;
            $(button_id).attr('disabled', 'disabled')
        }
        $(".js-mapbtn").click(function () {
            $('html, body').animate({
                scrollTop: $("#js-map").offset().top
            }, 500);
        });
    </script>
{% endblock %}